<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResumeCraft AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        #live-preview {
            font-family: Arial, sans-serif !important;
            line-height: 1.5 !important;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: white;
        }        // ============================================
        // RESUME CRAFT AI - MAIN APPLICATION
        // ============================================

        // Global State
        const state = {
            jobDetails: {
                title: '',
                company: '',
                location: '',
                description: '',
                skills: [],
                experienceLevel: '',
                employmentType: ''
            },
            resume: {
                personalInfo: {
                    fullName: '',
                    title: '',
                    email: '',
                    phone: '',
                    location: '',
                    linkedin: ''
                },
                summary: '',
                experience: [],
                education: [],
                skills: [],
                certifications: []
            },
            uploadedFiles: [],
            extractedText: '',
            atsScore: 0,
            currentTemplate: 'modern',
            darkMode: false,
            versionHistory: []
        };

        // Action Verbs for Analysis
        const actionVerbs = [
            'achieved', 'accomplished', 'administered', 'analyzed', 'architected', 'arranged',
            'built', 'boosted', 'collaborated', 'conducted', 'coordinated', 'created',
            'delivered', 'designed', 'developed', 'directed', 'drove', 'engineered',
            'established', 'executed', 'expanded', 'facilitated', 'formed', 'founded',
            'generated', 'grew', 'guided', 'headed', 'implemented', 'improved',
            'increased', 'initiated', 'innovated', 'integrated', 'introduced', 'launched',
            'led', 'managed', 'mentored', 'negotiated', 'operated', 'optimized',
            'organized', 'oversaw', 'planned', 'produced', 'programmed', 'reduced',
            'restructured', 'spearheaded', 'streamlined', 'supervised', 'transformed'
        ];

        // Common ATS Keywords by Industry
        const industryKeywords = {
            tech: ['javascript', 'python', 'react', 'node.js', 'aws', 'docker', 'kubernetes', 'sql', 'git', 'agile'],
            marketing: ['seo', 'sem', 'google analytics', 'content strategy', 'social media', 'crm', 'email marketing'],
            sales: ['crm', 'lead generation', 'account management', 'negotiation', 'forecasting', 'pipeline'],
            finance: ['financial modeling', 'excel', 'accounting', 'budgeting', 'forecasting', 'analysis'],
            healthcare: ['patient care', 'clinical', 'emr', 'hipaa', 'certification', 'medical'],
            general: ['leadership', 'communication', 'project management', 'problem solving', 'teamwork', 'analytical']
        };

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            createParticles();
            initializeTabs();
            initializeInputTabs();
            initializeTemplateSelector();
            initializeDragAndDrop();
            initializeTagInputs();
            initializeScrollAnimations();
            initializeSortableLists();
            loadFromLocalStorage();
            startDemoAnimation();
            
            // Check system dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
                document.body.classList.add('light-mode');
                state.darkMode = false;
            }
        }

        // ============================================
        // UI HELPERS
        // ============================================
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'error' ? 'exclamation-circle' : 'info-circle';
            
            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        function showLoading(text = 'Processing...') {
            const overlay = document.getElementById('loadingOverlay');
            overlay.querySelector('.loading-text').textContent = text;
            overlay.classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function toggleDarkMode() {
            state.darkMode = !state.darkMode;
            document.body.classList.toggle('light-mode');
            const icon = document.getElementById('darkModeIcon');
            icon.className = state.darkMode ? 'fas fa-sun' : 'fas fa-moon';
            saveToLocalStorage();
        }

        // ============================================
        // PARTICLE ANIMATION
        // ============================================
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (5 + Math.random() * 5) + 's';
                container.appendChild(particle);
            }
        }

        function startDemoAnimation() {
            const keywords = [
                { text: 'JavaScript', match: true },
                { text: 'React', match: true },
                { text: 'Node.js', match: true },
                { text: 'Python', match: false },
                { text: 'AWS', match: true },
                { text: 'Docker', match: false },
                { text: 'SQL', match: true },
                { text: 'Kubernetes', match: false }
            ];

            const container = document.getElementById('demoKeywords');
            let score = 0;
            const targetScore = 78;
            
            // Animate score
            const scoreInterval = setInterval(() => {
                score += 2;
                if (score >= targetScore) {
                    score = targetScore;
                    clearInterval(scoreInterval);
                }
                document.getElementById('demoScoreValue').textContent = score;
                const offset = 377 - (377 * score / 100);
                document.getElementById('demoScoreCircle').style.strokeDashoffset = offset;
            }, 30);

            // Add keywords with delay
            keywords.forEach((kw, i) => {
                setTimeout(() => {
                    const tag = document.createElement('span');
                    tag.className = `keyword-tag ${kw.match ? 'keyword-match' : 'keyword-missing'}`;
                    tag.innerHTML = kw.match ? 
                        `<i class="fas fa-check"></i> ${kw.text}` : 
                        `<i class="fas fa-times"></i> ${kw.text}`;
                    container.appendChild(tag);
                }, i * 200);
            });
        }

        // ============================================
        // TAB NAVIGATION
        // ============================================
        function initializeTabs() {
            const tabs = document.querySelectorAll('.app-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const tabId = tab.dataset.tab;
                    showPanel(tabId);
                });
            });
        }

        function showPanel(tabId) {
            const panels = ['job-input', 'resume-upload', 'ats-analysis', 'editor', 'preview'];
            panels.forEach(panel => {
                const el = document.getElementById(`${panel}-panel`);
                if (el) el.style.display = panel === tabId ? 'block' : 'none';
            });
            
            // Update info panel
            updateInfoPanel(tabId);
            
            // Special handlers
            if (tabId === 'preview') {
                renderResumePreview();
            } else if (tabId === 'ats-analysis') {
                updateATSResults();
            }
        }

        function updateInfoPanel(tabId) {
            const titles = {
                'job-input': 'Job Details',
                'resume-upload': 'Upload Resume',
                'ats-analysis': 'ATS Analysis',
                'editor': 'Resume Editor',
                'preview': 'Preview & Export'
            };
            
            document.getElementById('infoPanelTitle').textContent = titles[tabId] || 'Information';
        }

        function initializeInputTabs() {
            const tabs = document.querySelectorAll('.input-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    const tabId = tab.dataset.inputTab;
                    document.querySelectorAll('.input-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }

        // ============================================
        // JOB INPUT HANDLERS
        // ============================================
        function parseLinkedInUrl() {
            const url = document.getElementById('linkedinUrl').value.trim();
            
            if (!url || !url.includes('linkedin.com')) {
                showToast('Please enter a valid LinkedIn URL', 'error');
                return;
            }
            
            showLoading('Extracting job details...');
            
            // Simulate LinkedIn parsing (in production, this would use a proxy service)
            setTimeout(() => {
                // Extract job ID from URL if present
                const jobMatch = url.match(/view\/(\d+)/);
                
                if (jobMatch) {
                    // Mock extracted data
                    state.jobDetails = {
                        title: 'Senior Software Engineer',
                        company: 'TechCorp Inc.',
                        location: 'San Francisco, CA (Remote)',
                        description: 'We are looking for a Senior Software Engineer with 5+ years of experience in JavaScript, React, and Node.js. Experience with AWS, Docker, and microservices architecture preferred.',
                        skills: ['JavaScript', 'React', 'Node.js', 'AWS', 'Docker', 'Microservices'],
                        experienceLevel: 'senior',
                        employmentType: 'full-time'
                    };
                    
                    populateJobFields();
                    showToast('Job details extracted successfully!', 'success');
                } else {
                    showToast('Could not extract job details. Please try manual entry.', 'warning');
                }
                
                hideLoading();
            }, 1500);
        }

        function analyzeJobDescription() {
            const description = document.getElementById('jobDescription').value.trim();
            
            if (!description || description.length < 50) {
                showToast('Please enter a detailed job description', 'error');
                return;
            }
            
            showLoading('Analyzing job description...');
            
            setTimeout(() => {
                // Extract keywords and skills from description
                const extractedSkills = extractSkillsFromText(description);
                const extractedTitle = extractJobTitle(description);
                
                state.jobDetails.description = description;
                state.jobDetails.skills = extractedSkills;
                if (extractedTitle) state.jobDetails.title = extractedTitle;
                
                // Auto-detect experience level
                if (description.toLowerCase().includes('senior') || description.toLowerCase().includes('5+ years')) {
                    state.jobDetails.experienceLevel = 'senior';
                } else if (description.toLowerCase().includes('junior') || description.toLowerCase().includes('entry')) {
                    state.jobDetails.experienceLevel = 'entry';
                } else {
                    state.jobDetails.experienceLevel = 'mid';
                }
                
                populateJobFields();
                showToast(`Found ${extractedSkills.length} relevant skills`, 'success');
                hideLoading();
            }, 1000);
        }

        function extractSkillsFromText(text) {
            const allKeywords = [...industryKeywords.tech, ...industryKeywords.general];
            const found = [];
            const lowerText = text.toLowerCase();
            
            allKeywords.forEach(keyword => {
                if (lowerText.includes(keyword.toLowerCase()) && !found.includes(keyword)) {
                    found.push(keyword);
                }
            });
            
            return found.slice(0, 10);
        }

        function extractJobTitle(text) {
            const patterns = [
                /(?:seeking|hiring|looking for)\s+(?:a|an)?\s+([^,.]+(?:engineer|developer|manager|analyst|designer|specialist)[^,.]*)/i,
                /^([^-\n]+(?:engineer|developer|manager|analyst|designer|specialist)[^-\n]*)/i
            ];
            
            for (const pattern of patterns) {
                const match = text.match(pattern);
                if (match) return match[1].trim();
            }
            return '';
        }

        function populateJobFields() {
            document.getElementById('jobTitle').value = state.jobDetails.title;
            document.getElementById('companyName').value = state.jobDetails.company;
            document.getElementById('jobLocation').value = state.jobDetails.location;
            document.getElementById('manualJobDesc').value = state.jobDetails.description;
            document.getElementById('experienceLevel').value = state.jobDetails.experienceLevel;
            document.getElementById('employmentType').value = state.jobDetails.employmentType;
            
            // Populate skills tags
            const container = document.getElementById('skillsContainer');
            container.innerHTML = '';
            state.jobDetails.skills.forEach(skill => addSkillTag(skill, container));
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'tag-input';
            input.id = 'skillsInput';
            input.placeholder = 'Type skill and press Enter...';
            container.appendChild(input);
            setupTagInput(input, container, 'job');
        }

        function saveJobDetails() {
            state.jobDetails.title = document.getElementById('jobTitle').value;
            state.jobDetails.company = document.getElementById('companyName').value;
            state.jobDetails.location = document.getElementById('jobLocation').value;
            state.jobDetails.description = document.getElementById('manualJobDesc').value;
            state.jobDetails.experienceLevel = document.getElementById('experienceLevel').value;
            state.jobDetails.employmentType = document.getElementById('employmentType').value;
            
            if (!state.jobDetails.title) {
                showToast('Job title is required', 'error');
                return;
            }
            
            saveToLocalStorage();
            showToast('Job details saved!', 'success');
        }

        // ============================================
        // TAG INPUTS
        // ============================================
        function initializeTagInputs() {
            const jobSkillsInput = document.getElementById('skillsInput');
            const jobContainer = document.getElementById('skillsContainer');
            if (jobSkillsInput) {
                setupTagInput(jobSkillsInput, jobContainer, 'job');
            }
            
            const resumeSkillsInput = document.getElementById('resumeSkillsInput');
            const resumeContainer = document.getElementById('resumeSkillsContainer');
            if (resumeSkillsInput) {
                setupTagInput(resumeSkillsInput, resumeContainer, 'resume');
            }
        }

        function setupTagInput(input, container, type) {
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const value = input.value.trim();
                    if (value) {
                        addSkillTag(value, container);
                        input.value = '';
                        
                        if (type === 'job') {
                            if (!state.jobDetails.skills.includes(value)) {
                                state.jobDetails.skills.push(value);
                            }
                        } else {
                            if (!state.resume.skills.includes(value)) {
                                state.resume.skills.push(value);
                            }
                        }
                        saveToLocalStorage();
                    }
                }
            });
        }

        function addSkillTag(skill, container) {
            const tag = document.createElement('span');
            tag.className = 'tag';
            tag.innerHTML = `${skill} <button onclick="this.parentElement.remove()">&times;</button>`;
            container.insertBefore(tag, container.querySelector('.tag-input'));
        }

        // ============================================
        // FILE UPLOAD
        // ============================================
        function initializeDragAndDrop() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            
            dropZone.addEventListener('click', () => fileInput.click());
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                handleFiles(e.dataTransfer.files);
            });
            
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
        }

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.size > 10 * 1024 * 1024) {
                    showToast(`${file.name} is too large (max 10MB)`, 'error');
                    return;
                }
                
                state.uploadedFiles.push(file);
                displayFile(file);
            });
            
            document.getElementById('analyzeBtn').disabled = state.uploadedFiles.length === 0;
        }

        function displayFile(file) {
            const list = document.getElementById('fileList');
            const item = document.createElement('div');
            item.className = 'file-item';
            item.innerHTML = `
                <div class="file-icon">
                    <i class="fas fa-${file.name.endsWith('.pdf') ? 'file-pdf' : 'file-word'}"></i>
                </div>
                <div class="file-info">
                    <div class="file-name">${file.name}</div>
                    <div class="file-meta">${(file.size / 1024).toFixed(1)} KB</div>
                </div>
                <button class="file-remove" onclick="removeFile('${file.name}')">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            list.appendChild(item);
        }

        function removeFile(fileName) {
            state.uploadedFiles = state.uploadedFiles.filter(f => f.name !== fileName);
            document.getElementById('fileList').innerHTML = '';
            state.uploadedFiles.forEach(displayFile);
            document.getElementById('analyzeBtn').disabled = state.uploadedFiles.length === 0;
        }

        async function analyzeResume() {
            if (state.uploadedFiles.length === 0) {
                showToast('Please upload a resume first', 'error');
                return;
            }
            
            showLoading('Analyzing resume...');
            
            try {
                const file = state.uploadedFiles[0];
                let text = '';
                
                if (file.name.endsWith('.pdf')) {
                    text = await extractPDFText(file);
                } else {
                    text = await extractDOCXText(file);
                }
                
                state.extractedText = text;
                
                // Perform ATS analysis
                performATSAnalysis(text);
                
                // Switch to analysis tab
                document.querySelector('[data-tab="ats-analysis"]').click();
                
                showToast('Analysis complete!', 'success');
            } catch (error) {
                showToast('Error analyzing resume: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        async function extractPDFText(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let text = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(' ') + ' ';
            }
            
            return text;
        }

        async function extractDOCXText(file) {
            // For DOCX, we'd need a proper parser. For now, return placeholder
            showToast('DOCX parsing uses basic extraction. PDF recommended for best results.', 'warning');
            return 'Extracted text from DOCX file. Full parsing would require additional libraries.';
        }

        // ============================================
        // ATS ANALYSIS ENGINE
        // ============================================
        function performATSAnalysis(resumeText) {
            const resumeLower = resumeText.toLowerCase();
            const jobDescLower = state.jobDetails.description.toLowerCase();
            
            // Calculate keyword match
            const jobSkills = state.jobDetails.skills.map(s => s.toLowerCase());
            const matchedKeywords = [];
            const missingKeywords = [];
            
            jobSkills.forEach(skill => {
                if (resumeLower.includes(skill)) {
                    matchedKeywords.push(skill);
                } else {
                    missingKeywords.push(skill);
                }
            });
            
            // Check action verbs
            const usedActionVerbs = actionVerbs.filter(verb => resumeLower.includes(verb));
            const actionVerbScore = Math.min(100, (usedActionVerbs.length / 5) * 100);
            
            // Check formatting issues
            const formatIssues = [];
            if (resumeText.length < 500) formatIssues.push('Resume seems too short');
            if (resumeText.length > 5000) formatIssues.push('Resume may be too long');
            if (!resumeLower.includes('experience')) formatIssues.push('No experience section detected');
            if (!resumeLower.includes('education')) formatIssues.push('No education section detected');
            
            // Calculate scores
            const keywordScore = jobSkills.length > 0 ? 
                Math.round((matchedKeywords.length / jobSkills.length) * 100) : 50;
            const formatScore = Math.max(0, 100 - (formatIssues.length * 15));
            const contentScore = Math.round((actionVerbScore + keywordScore) / 2);
            
            state.atsScore = Math.round((keywordScore + formatScore + contentScore) / 3);
            
            // Store analysis results
            state.analysisResults = {
                overallScore: state.atsScore,
                keywordScore,
                formatScore,
                contentScore,
                matchedKeywords,
                missingKeywords,
                usedActionVerbs,
                formatIssues,
                suggestions: generateSuggestions(matchedKeywords, missingKeywords, formatIssues, usedActionVerbs)
            };
            
            saveToLocalStorage();
        }

        function generateSuggestions(matched, missing, formatIssues, actionVerbs) {
            const suggestions = [];
            
            // Missing keywords suggestions
            if (missing.length > 0) {
                suggestions.push({
                    type: 'critical',
                    title: 'Missing Key Skills',
                    description: `Add these keywords to your resume: ${missing.slice(0, 5).join(', ')}`,
                    action: 'Add Skills'
                });
            }
            
            // Action verbs
            if (actionVerbs.length < 3) {
                suggestions.push({
                    type: 'warning',
                    title: 'Use More Action Verbs',
                    description: 'Start bullet points with strong action verbs like "Developed", "Led", "Implemented"',
                    action: 'View Examples'
                });
            }
            
            // Format issues
            formatIssues.forEach(issue => {
                suggestions.push({
                    type: 'info',
                    title: 'Formatting Issue',
                    description: issue,
                    action: 'Fix Now'
                });
            });
            
            // Generic improvements
            suggestions.push({
                type: 'info',
                title: 'Quantify Achievements',
                description: 'Add numbers and metrics to showcase your impact (e.g., "Increased revenue by 25%")',
                action: 'Learn More'
            });
            
            return suggestions;
        }

        function updateATSResults() {
            const results = state.analysisResults;
            
            if (!results) {
                document.getElementById('resultsContent').style.display = 'none';
                document.getElementById('noResultsMessage').style.display = 'block';
                return;
            }
            
            document.getElementById('resultsContent').style.display = 'block';
            document.getElementById('noResultsMessage').style.display = 'none';
            
            // Update scores
            document.getElementById('overallScore').textContent = results.overallScore;
            document.getElementById('keywordScore').textContent = results.keywordScore + '%';
            document.getElementById('formatScore').textContent = results.formatScore + '%';
            document.getElementById('contentScore').textContent = results.contentScore + '%';
            
            // Update score colors
            const overallEl = document.getElementById('overallScore');
            overallEl.className = 'score-card-value ' + 
                (results.overallScore >= 80 ? 'excellent' : 
                 results.overallScore >= 60 ? 'good' : 'poor');
            
            // Update keywords
            const matchingContainer = document.getElementById('matchingKeywords');
            const missingContainer = document.getElementById('missingKeywords');
            
            matchingContainer.innerHTML = results.matchedKeywords.map(kw => 
                `<span class="keyword-tag keyword-match"><i class="fas fa-check"></i> ${kw}</span>`
            ).join('');
            
            missingContainer.innerHTML = results.missingKeywords.map(kw => 
                `<span class="keyword-tag keyword-missing"><i class="fas fa-times"></i> ${kw}</span>`
            ).join('');
            
            // Update suggestions
            const suggestionsList = document.getElementById('suggestionsList');
            suggestionsList.innerHTML = results.suggestions.map(s => `
                <li class="suggestion-item ${s.type}">
                    <div class="suggestion-icon">
                        <i class="fas fa-${s.type === 'critical' ? 'exclamation' : s.type === 'warning' ? 'exclamation-triangle' : 'info'}"></i>
                    </div>
                    <div class="suggestion-content">
                        <div class="suggestion-title">${s.title}</div>
                        <div class="suggestion-desc">${s.description}</div>
                        <button class="suggestion-action" onclick="applySuggestion('${s.title}')">${s.action}</button>
                    </div>
                </li>
            `).join('');
        }

        function applySuggestion(title) {
            showToast(`Applied: ${title}`, 'success');
        }

        // ============================================
        // RESUME EDITOR
        // ============================================
        function initializeTemplateSelector() {
            document.querySelectorAll('.template-option').forEach(option => {
                option.addEventListener('click', () => {
                    const parent = option.closest('.template-grid');
                    parent.querySelectorAll('.template-option').forEach(o => o.classList.remove('active'));
                    option.classList.add('active');
                    state.currentTemplate = option.dataset.template || option.dataset.previewTemplate;
                    saveToLocalStorage();
                });
            });
        }

        function initializeSortableLists() {
            ['experienceList', 'educationList', 'certificationList'].forEach(id => {
                const el = document.getElementById(id);
                if (el && typeof Sortable !== 'undefined') {
                    new Sortable(el, {
                        animation: 150,
                        handle: '.entry-item',
                        ghostClass: 'dragging'
                    });
                }
            });
        }

        function formatText(command) {
            document.execCommand(command, false, null);
        }

        function generateSummary() {
            const name = document.getElementById('fullName').value || 'Professional';
            const title = document.getElementById('professionalTitle').value || 'Professional';
            
            const summaries = [
                `Results-driven ${title} with extensive experience delivering high-impact solutions. Proven track record of leading cross-functional teams and driving business growth through innovative strategies.`,
                `Dedicated ${title} passionate about creating exceptional results. Skilled in problem-solving, collaboration, and continuous improvement with a focus on exceeding expectations.`,
                `Dynamic ${title} combining technical expertise with strong business acumen. Committed to leveraging skills and experience to drive organizational success and deliver measurable outcomes.`
            ];
            
            const summary = summaries[Math.floor(Math.random() * summaries.length)];
            document.getElementById('summaryEditor').innerHTML = summary;
            state.resume.summary = summary;
            saveToLocalStorage();
            
            showToast('Summary generated!', 'success');
        }

        function addExperience() {
            const list = document.getElementById('experienceList');
            const id = Date.now();
            
            const entry = document.createElement('li');
            entry.className = 'entry-item';
            entry.dataset.id = id;
            entry.innerHTML = `
                <div class="entry-header">
                    <div>
                        <div class="entry-title">
                            <input type="text" class="form-input" placeholder="Job Title" style="margin-bottom:0.5rem;" onchange="updateEntry(${id}, 'title', this.value)">
                        </div>
                        <div class="entry-subtitle">
                            <input type="text" class="form-input" placeholder="Company Name" style="margin-bottom:0.5rem;" onchange="updateEntry(${id}, 'company', this.value)">
                            <input type="text" class="form-input" placeholder="Dates (e.g., Jan 2020 - Present)" onchange="updateEntry(${id}, 'dates', this.value)">
                        </div>
                    </div>
                    <div class="entry-actions">
                        <button class="entry-action delete" onclick="removeEntry(this)" title="Remove">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <textarea class="form-textarea" placeholder="Describe your responsibilities and achievements..." rows="3" onchange="updateEntry(${id}, 'description', this.value)"></textarea>
            `;
            
            list.appendChild(entry);
            
            state.resume.experience.push({
                id,
                title: '',
                company: '',
                dates: '',
                description: ''
            });
        }

        function addEducation() {
            const list = document.getElementById('educationList');
            const id = Date.now();
            
            const entry = document.createElement('li');
            entry.className = 'entry-item';
            entry.dataset.id = id;
            entry.innerHTML = `
                <div class="entry-header">
                    <div>
                        <div class="entry-title">
                            <input type="text" class="form-input" placeholder="Degree" style="margin-bottom:0.5rem;" onchange="updateEducation(${id}, 'degree', this.value)">
                        </div>
                        <div class="entry-subtitle">
                            <input type="text" class="form-input" placeholder="Institution" style="margin-bottom:0.5rem;" onchange="updateEducation(${id}, 'institution', this.value)">
                            <input type="text" class="form-input" placeholder="Year" onchange="updateEducation(${id}, 'year', this.value)">
                        </div>
                    </div>
                    <div class="entry-actions">
                        <button class="entry-action delete" onclick="removeEntry(this)" title="Remove">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            list.appendChild(entry);
            
            state.resume.education.push({
                id,
                degree: '',
                institution: '',
                year: ''
            });
        }

        function addCertification() {
            const list = document.getElementById('certificationList');
            const id = Date.now();
            
            const entry = document.createElement('li');
            entry.className = 'entry-item';
            entry.dataset.id = id;
            entry.innerHTML = `
                <div class="entry-header">
                    <div>
                        <div class="entry-title">
                            <input type="text" class="form-input" placeholder="Certification Name" style="margin-bottom:0.5rem;" onchange="updateCertification(${id}, 'name', this.value)">
                        </div>
                        <div class="entry-subtitle">
                            <input type="text" class="form-input" placeholder="Issuing Organization" style="margin-bottom:0.5rem;" onchange="updateCertification(${id}, 'issuer', this.value)">
                            <input type="text" class="form-input" placeholder="Year" onchange="updateCertification(${id}, 'year', this.value)">
                        </div>
                    </div>
                    <div class="entry-actions">
                        <button class="entry-action delete" onclick="removeEntry(this)" title="Remove">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            list.appendChild(entry);
            
            state.resume.certifications.push({
                id,
                name: '',
                issuer: '',
                year: ''
            });
        }

        function removeEntry(btn) {
            const item = btn.closest('.entry-item');
            const id = parseInt(item.dataset.id);
            const type = item.closest('#experienceList') ? 'experience' : 
                        item.closest('#educationList') ? 'education' : 'certifications';
            
            state.resume[type] = state.resume[type].filter(e => e.id !== id);
            item.remove();
            saveToLocalStorage();
        }

        function updateEntry(id, field, value) {
            const entry = state.resume.experience.find(e => e.id === id);
            if (entry) {
                entry[field] = value;
                saveToLocalStorage();
            }
        }

        function updateEducation(id, field, value) {
            const entry = state.resume.education.find(e => e.id === id);
            if (entry) {
                entry[field] = value;
                saveToLocalStorage();
            }
        }

        function updateCertification(id, field, value) {
            const entry = state.resume.certifications.find(e => e.id === id);
            if (entry) {
                entry[field] = value;
                saveToLocalStorage();
            }
        }

        function suggestSkills() {
            const jobTitle = document.getElementById('professionalTitle').value.toLowerCase();
            let suggestions = [];
            
            if (jobTitle.includes('engineer') || jobTitle.includes('developer')) {
                suggestions = ['JavaScript', 'Python', 'React', 'Node.js', 'SQL', 'Git', 'AWS'];
            } else if (jobTitle.includes('manager')) {
                suggestions = ['Leadership', 'Project Management', 'Strategy', 'Team Building', 'Budgeting'];
            } else if (jobTitle.includes('designer')) {
                suggestions = ['Figma', 'Adobe Creative Suite', 'UI/UX', 'Prototyping', 'User Research'];
            } else {
                suggestions = ['Communication', 'Problem Solving', 'Teamwork', 'Microsoft Office', 'Analysis'];
            }
            
            const container = document.getElementById('resumeSkillsContainer');
            suggestions.forEach(skill => {
                if (!state.resume.skills.includes(skill)) {
                    addSkillTag(skill, container);
                    state.resume.skills.push(skill);
                }
            });
            
            saveToLocalStorage();
            showToast(`Added ${suggestions.length} suggested skills`, 'success');
        }

        // ============================================
        // RESUME PREVIEW & EXPORT
        // ============================================
        function renderResumePreview() {
            const preview = document.getElementById('resumePreview');
            const data = state.resume;
            
            // Update from form inputs
            data.personalInfo.fullName = document.getElementById('fullName').value;
            data.personalInfo.title = document.getElementById('professionalTitle').value;
            data.personalInfo.email = document.getElementById('email').value;
            data.personalInfo.phone = document.getElementById('phone').value;
            data.personalInfo.location = document.getElementById('location').value;
            data.personalInfo.linkedin = document.getElementById('linkedinProfile').value;
            data.summary = document.getElementById('summaryEditor').innerHTML;
            
            const template = state.currentTemplate;
            
            let html = '';
            
            if (template === 'modern') {
                html = renderModernTemplate(data);
            } else if (template === 'professional') {
                html = renderProfessionalTemplate(data);
            } else if (template === 'minimal') {
                html = renderMinimalTemplate(data);
            } else {
                html = renderModernTemplate(data);
            }
            
            preview.innerHTML = html;
        }

        function renderModernTemplate(data) {
            return `
                <div style="font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 0 auto;">
                    <header style="border-bottom: 3px solid #6366f1; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="font-size: 2.5rem; margin: 0; color: #1a1a1a;">${data.personalInfo.fullName || 'Your Name'}</h1>
                        <p style="font-size: 1.2rem; color: #6366f1; margin: 10px 0;">${data.personalInfo.title || 'Professional Title'}</p>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap; font-size: 0.9rem; color: #666;">
                            ${data.personalInfo.email ? `<span>&#9993; ${data.personalInfo.email}</span>` : ''}
                            ${data.personalInfo.phone ? `<span>&#9742; ${data.personalInfo.phone}</span>` : ''}
                            ${data.personalInfo.location ? `<span>&#128205; ${data.personalInfo.location}</span>` : ''}
                            ${data.personalInfo.linkedin ? `<span>&#128188; ${data.personalInfo.linkedin}</span>` : ''}
                        </div>
                    </header>
                    
                    ${data.summary ? `
                    <section style="margin-bottom: 30px;">
                        <h2 style="color: #1a1a1a; font-size: 1.3rem; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px;">Professional Summary</h2>
                        <p style="color: #555; line-height: 1.6;">${data.summary}</p>
                    </section>
                    ` : ''}
                    
                    ${data.experience.length > 0 ? `
                    <section style="margin-bottom: 30px;">
                        <h2 style="color: #1a1a1a; font-size: 1.3rem; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px;">Work Experience</h2>
                        ${data.experience.map(exp => `
                            <div style="margin-bottom: 20px;">
                                <h3 style="margin: 0; color: #333;">${exp.title || 'Position'}</h3>
                                <p style="margin: 5px 0; color: #6366f1; font-weight: 500;">${exp.company || 'Company'} | ${exp.dates || 'Dates'}</p>
                                <p style="color: #555; line-height: 1.6;">${exp.description || ''}</p>
                            </div>
                        `).join('')}
                    </section>
                    ` : ''}
                    
                    ${data.education.length > 0 ? `
                    <section style="margin-bottom: 30px;">
                        <h2 style="color: #1a1a1a; font-size: 1.3rem; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px;">Education</h2>
                        ${data.education.map(edu => `
                            <div style="margin-bottom: 15px;">
                                <h3 style="margin: 0; color: #333;">${edu.degree || 'Degree'}</h3>
                                <p style="margin: 5px 0; color: #666;">${edu.institution || 'Institution'} | ${edu.year || 'Year'}</p>
                            </div>
                        `).join('')}
                    </section>
                    ` : ''}
                    
                    ${data.skills.length > 0 ? `
                    <section style="margin-bottom: 30px;">
                        <h2 style="color: #1a1a1a; font-size: 1.3rem; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px;">Skills</h2>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                            ${data.skills.map(skill => `
                                <span style="background: #f0f0f0; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">${skill}</span>
                            `).join('')}
                        </div>
                    </section>
                    ` : ''}
                    
                    ${data.certifications.length > 0 ? `
                    <section>
                        <h2 style="color: #1a1a1a; font-size: 1.3rem; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px;">Certifications</h2>
                        ${data.certifications.map(cert => `
                            <div style="margin-bottom: 10px;">
                                <p style="margin: 0; color: #333;"><strong>${cert.name || 'Certification'}</strong> - ${cert.issuer || 'Issuer'} (${cert.year || 'Year'})</p>
                            </div>
                        `).join('')}
                    </section>
                    ` : ''}
                </div>
            `;
        }

        function renderProfessionalTemplate(data) {
            return `
                <div style="font-family: Georgia, serif; max-width: 800px; margin: 0 auto;">
                    <header style="text-align: center; margin-bottom: 40px;">
                        <h1 style="font-size: 2.2rem; margin: 0; text-transform: uppercase; letter-spacing: 2px;">${data.personalInfo.fullName || 'Your Name'}</h1>
                        <p style="font-size: 1rem; color: #555; margin-top: 10px;">
                            ${[data.personalInfo.title, data.personalInfo.email, data.personalInfo.phone].filter(Boolean).join(' | ')}
                        </p>
                    </header>
                    
                    ${data.summary ? `
                    <section style="margin-bottom: 30px;">
                        <h2 style="font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333;">Summary</h2>
                        <p style="color: #444; line-height: 1.6;">${data.summary}</p>
                    </section>
                    ` : ''}
                    
                    ${data.experience.length > 0 ? `
                    <section style="margin-bottom: 30px;">
                        <h2 style="font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333;">Experience</h2>
                        ${data.experience.map(exp => `
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: baseline;">
                                    <h3 style="margin: 0; font-size: 1rem;">${exp.title || 'Position'}</h3>
                                    <span style="color: #666; font-size: 0.9rem;">${exp.dates || ''}</span>
                                </div>
                                <p style="margin: 5px 0; color: #555; font-style: italic;">${exp.company || 'Company'}</p>
                                <p style="color: #444; line-height: 1.6;">${exp.description || ''}</p>
                            </div>
                        `).join('')}
                    </section>
                    ` : ''}
                    
                    ${data.education.length > 0 ? `
                    <section style="margin-bottom: 30px;">
                        <h2 style="font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333;">Education</h2>
                        ${data.education.map(edu => `
                            <div style="margin-bottom: 15px;">
                                <p style="margin: 0;"><strong>${edu.degree || 'Degree'}</strong>, ${edu.institution || 'Institution'} (${edu.year || 'Year'})</p>
                            </div>
                        `).join('')}
                    </section>
                    ` : ''}
                    
                    ${data.skills.length > 0 ? `
                    <section>
                        <h2 style="font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333;">Skills</h2>
                        <p style="color: #444;">${data.skills.join(', ')}</p>
                    </section>
                    ` : ''}
                </div>
            `;
        }

        function renderMinimalTemplate(data) {
            return `
                <div style="font-family: -apple-system, sans-serif; max-width: 700px; margin: 0 auto; line-height: 1.8;">
                    <header style="margin-bottom: 40px;">
                        <h1 style="font-size: 1.8rem; margin: 0; font-weight: 400;">${data.personalInfo.fullName || 'Your Name'}</h1>
                        <p style="margin: 10px 0; color: #666;">${data.personalInfo.title || ''}</p>
                        <p style="margin: 0; color: #999; font-size: 0.9rem;">
                            ${[data.personalInfo.email, data.personalInfo.phone, data.personalInfo.location].filter(Boolean).join(' &#183; ')}
                        </p>
                    </header>
                    
                    ${data.summary ? `<p style="color: #555; margin-bottom: 30px;">${data.summary}</p>` : ''}
                    
                    ${data.experience.length > 0 ? `
                    <section style="margin-bottom: 30px;">
                        <h2 style="font-size: 0.8rem; text-transform: uppercase; color: #999; letter-spacing: 2px; margin-bottom: 20px;">Experience</h2>
                        ${data.experience.map(exp => `
                            <div style="margin-bottom: 25px;">
                                <h3 style="margin: 0; font-size: 1rem; font-weight: 600;">${exp.title || 'Position'}</h3>
                                <p style="margin: 5px 0; color: #666; font-size: 0.9rem;">${exp.company || 'Company'} &#183; ${exp.dates || ''}</p>
                                <p style="color: #555; font-size: 0.95rem;">${exp.description || ''}</p>
                            </div>
                        `).join('')}
                    </section>
                    ` : ''}
                    
                    ${data.education.length > 0 ? `
                    <section style="margin-bottom: 30px;">
                        <h2 style="font-size: 0.8rem; text-transform: uppercase; color: #999; letter-spacing: 2px; margin-bottom: 20px;">Education</h2>
                        ${data.education.map(edu => `
                            <p style="margin: 0 0 10px 0; color: #555;">${edu.degree || 'Degree'} &#183; ${edu.institution || 'Institution'} &#183; ${edu.year || ''}</p>
                        `).join('')}
                    </section>
                    ` : ''}
                    
                    ${data.skills.length > 0 ? `
                    <section>
                        <h2 style="font-size: 0.8rem; text-transform: uppercase; color: #999; letter-spacing: 2px; margin-bottom: 20px;">Skills</h2>
                        <p style="color: #555; margin: 0;">${data.skills.join(' &#183; ')}</p>
                    </section>
                    ` : ''}
                </div>
            `;
        }

        function downloadPDF() {
            const element = document.getElementById('resumePreview');
            
            const opt = {
                margin: 10,
                filename: `${state.resume.personalInfo.fullName || 'Resume'}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            showLoading('Generating PDF...');
            
            html2pdf().set(opt).from(element).save().then(() => {
                hideLoading();
                showToast('PDF downloaded successfully!', 'success');
            }).catch(err => {
                hideLoading();
                showToast('Error generating PDF: ' + err.message, 'error');
            });
        }

        function downloadDOCX() {
            const content = document.getElementById('resumePreview').innerHTML;
            const blob = new Blob([
                `<!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${state.resume.personalInfo.fullName || 'Resume'}</title>
                </head>
                <body>
                    ${content}
                </body>
                </html>`
            ], { type: 'application/msword' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${state.resume.personalInfo.fullName || 'Resume'}.doc`;
            link.click();
            
            showToast('DOCX downloaded!', 'success');
        }

        function copyResumeText() {
            const text = document.getElementById('resumePreview').innerText;
            navigator.clipboard.writeText(text).then(() => {
                showToast('Resume text copied to clipboard!', 'success');
            });
        }

        function generateShareLink() {
            const data = btoa(JSON.stringify(state.resume));
            const url = `${window.location.origin}${window.location.pathname}?resume=${data}`;
            
            navigator.clipboard.writeText(url).then(() => {
                showToast('Share link copied to clipboard!', 'success');
            });
        }

        // ============================================
        // LOCAL STORAGE
        // ============================================
        function saveToLocalStorage() {
            try {
                localStorage.setItem('resumecraft_state', JSON.stringify(state));
                
                // Save version history
                const history = JSON.parse(localStorage.getItem('resumecraft_history') || '[]');
                history.push({
                    timestamp: Date.now(),
                    preview: state.resume.personalInfo.fullName || 'Untitled'
                });
                if (history.length > 10) history.shift();
                localStorage.setItem('resumecraft_history', JSON.stringify(history));
            } catch (e) {
                console.warn('Could not save to localStorage:', e);
            }
        }

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('resumecraft_state');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    Object.assign(state, parsed);
                    
                    // Restore form values
                    if (state.jobDetails) {
                        populateJobFields();
                    }
                    
                    if (state.resume) {
                        document.getElementById('fullName').value = state.resume.personalInfo.fullName || '';
                        document.getElementById('professionalTitle').value = state.resume.personalInfo.title || '';
                        document.getElementById('email').value = state.resume.personalInfo.email || '';
                        document.getElementById('phone').value = state.resume.personalInfo.phone || '';
                        document.getElementById('location').value = state.resume.personalInfo.location || '';
                        document.getElementById('linkedinProfile').value = state.resume.personalInfo.linkedin || '';
                        document.getElementById('summaryEditor').innerHTML = state.resume.summary || '';
                        
                        // Restore skills
                        const container = document.getElementById('resumeSkillsContainer');
                        container.innerHTML = '';
                        state.resume.skills.forEach(skill => addSkillTag(skill, container));
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.className = 'tag-input';
                        input.id = 'resumeSkillsInput';
                        input.placeholder = 'Add skills and press Enter...';
                        container.appendChild(input);
                        setupTagInput(input, container, 'resume');
                    }
                }
                
                // Check for shared resume in URL
                const params = new URLSearchParams(window.location.search);
                const sharedResume = params.get('resume');
                if (sharedResume) {
                    try {
                        const resumeData = JSON.parse(atob(sharedResume));
                        state.resume = resumeData;
                        loadFromLocalStorage();
                        showToast('Shared resume loaded!', 'success');
                    } catch (e) {
                        console.error('Failed to load shared resume:', e);
                    }
                }
            } catch (e) {
                console.warn('Could not load from localStorage:', e);
            }
        }

        function importResume() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        Object.assign(state, data);
                        loadFromLocalStorage();
                        showToast('Resume imported successfully!', 'success');
                    } catch (err) {
                        showToast('Invalid resume file', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function exportResumeJSON() {
            const data = JSON.stringify(state, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'resumecraft_backup.json';
            link.click();
            showToast('Resume exported!', 'success');
        }

        // ============================================
        // SCROLL & NAVIGATION
        // ============================================
        function scrollToBuilder() {
            document.getElementById('builder').scrollIntoView({ behavior: 'smooth' });
        }

        function initializeScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.animate-on-scroll').forEach(el => {
                observer.observe(el);
            });
        }

        // ============================================
        // FAQ
        // ============================================
        function toggleFaq(element) {
            const item = element.parentElement;
            const wasActive = item.classList.contains('active');
            
            // Close all
            document.querySelectorAll('.faq-item').forEach(i => i.classList.remove('active'));
            
            // Open clicked if wasn't active
            if (!wasActive) {
                item.classList.add('active');
            }
        }

        // ============================================
        // NEWSLETTER
        // ============================================
        function subscribeNewsletter(e) {
            e.preventDefault();
            const email = document.getElementById('newsletterEmail').value;
            showToast(`Thanks for subscribing with ${email}!`, 'success');
            document.getElementById('newsletterEmail').value = '';
        }

        // ============================================
        // MODALS & PLACEHOLDERS
        // ============================================
        function showDemo() {
            showToast('Demo video coming soon!', 'info');
        }

        function showContactModal() {
            showToast('Contact form coming soon!', 'info');
        }

        function showTemplates() {
            scrollToBuilder();
            document.querySelector('[data-tab="editor"]').click();
        }

        function showBlog() {
            showToast('Blog coming soon!', 'info');
        }

        function showGuides() {
            showToast('Resume guides coming soon!', 'info');
        }

        function showExamples() {
            showToast('Example resumes coming soon!', 'info');
        }

        function showAbout() {
            showToast('About page coming soon!', 'info');
        }

        function showContact() {
            showToast('Contact page coming soon!', 'info');
        }

        function showPrivacy() {
            showToast('Privacy policy coming soon!', 'info');
        }

        function showTerms() {
            showToast('Terms of service coming soon!', 'info');
        }

        function closeModal() {
            document.getElementById('previewModal').classList.remove('active');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveToLocalStorage();
                        showToast('Resume saved!', 'success');
                        break;
                    case 'p':
                        e.preventDefault();
                        scrollToBuilder();
                        document.querySelector('[data-tab="preview"]').click();
                        break;
                }
            }
        });

        // Auto-save every 30 seconds
        setInterval(() => {
            saveToLocalStorage();
        }, 30000);

        // Export for debugging
        window.resumecraft = { state, exportResumeJSON };
    </script>
</body>
</html>